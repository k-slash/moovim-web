/*
 * jquery-gpopover
 * http://github.com/markembling/jquery-gpopover
 *
 * A simple jQuery plugin for creating popover elements similar to Google's
 * new 'apps' launcher/switcher.
 *
 * Copyright (c) 2013 Mark Embling (markembling.info)
 * Licensed under the BSD (3 clause) license.
 */
 (function(b){var a=function(d,c){this.options=null;this.$trigger=null;this.$popover=null;this.init(d,c)};a.prototype.init=function(d,c){var e=this;this.options=b.extend({},b.fn.gpopover.defaults,c);this.$trigger=b(d);this.$popover=b("#"+this.$trigger.data("popover"));this._addArrowElements();if(this.options.preventHide){this._preventHideClickPropagation()}this.$trigger.click(function(f){if(!e.$popover.is(":visible")){b(this).parent().click();e.show();f.stopPropagation()}f.preventDefault()})};a.prototype.show=function(){var c=this;this.$popover.width(this.options.width);this.$popover.fadeIn(this.options.fadeInDuration);b(document).one("click.popoverHide",function(){c.hide()});var e=this.$trigger.offset();this.$popover.offset({left:(e.left+(this.$trigger.outerWidth()/2))-(this.$popover.outerWidth()/2),top:e.top+this.$trigger.outerHeight()+10});var d=this._repositionForViewportSides();this._setArrowPosition(d);this.options.onShow.call(this.$trigger,this.$popover)};a.prototype.hide=function(){this.$popover.fadeOut(this.options.fadeOutDuration);this.options.onHide.call(this.$trigger,this.$popover)};a.prototype._addArrowElements=function(){this.$arrow=b('<div class="gpopover-arrow"></div>');this.$arrowShadow=b('<div class="gpopover-arrow-shadow"></div>');this.$popover.append(this.$arrow);this.$popover.append(this.$arrowShadow)};a.prototype._preventHideClickPropagation=function(){this.$popover.click(function(c){c.stopPropagation()})};a.prototype._repositionForViewportSides=function(){var e=this.$popover.offset().left,d=0,f=b(window);if(e+this.$popover.outerWidth()+this.options.viewportSideMargin>f.width()){var c=-((e+this.$popover.outerWidth()+this.options.viewportSideMargin)-f.width());e=e+c;d=c}if(e<this.options.viewportSideMargin){var g=this.options.viewportSideMargin-e;e=e+g;d+=g}if(d!==0){this.$popover.offset({left:e})}return d};a.prototype._setArrowPosition=function(d){var c=(this.$popover.outerWidth()/2)-(this.$arrow.outerWidth()/2)-d;this.$arrow.css({top:-7,left:c});this.$arrowShadow.css({top:-8,left:c})};b.fn.gpopover=function(c){return this.each(function(){var f=b(this),e=f.data("gpopover"),d=(typeof c=="object"&&c);if(!e){e=new a(this,d);f.data("gpopover",e)}if(typeof c=="string"){e[c]()}})};b.fn.gpopover.defaults={width:250,fadeInDuration:65,fadeOutDuration:65,viewportSideMargin:10,preventHide:false,onShow:function(){},onHide:function(){}}})(jQuery);